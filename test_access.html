<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ Project Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .warning { color: orange; }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ Project Manager</h1>
    
    <div class="container">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp</h2>
        <div id="telegram-status"></div>
        <button onclick="checkTelegramWebApp()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram WebApp</button>
    </div>

    <div class="container">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏</h2>
        <div id="api-status"></div>
        <button onclick="checkAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
    </div>

    <div class="container">
        <h2>3. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
        <div id="auth-status"></div>
        <button onclick="testAuth()">–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
        <button onclick="testCheckAccess()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
    </div>

    <div class="container">
        <h2>4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'https://projectmanager.chickenkiller.com/api';
        let currentUser = null;

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<div class="status ${type}">[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }

        async function checkTelegramWebApp() {
            const status = document.getElementById('telegram-status');
            status.innerHTML = '<div class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>';

            try {
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    const userData = tg.initDataUnsafe?.user;
                    
                    status.innerHTML = `
                        <div class="status success">
                            <strong>‚úÖ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω!</strong><br>
                            <pre>${JSON.stringify({
                                user: userData,
                                initData: tg.initData,
                                initDataUnsafe: tg.initDataUnsafe
                            }, null, 2)}</pre>
                        </div>
                    `;
                    log('Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    return userData;
                } else {
                    status.innerHTML = '<div class="status error">‚ùå Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                    log('Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    return null;
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
                log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram WebApp: ${error.message}`, 'error');
                return null;
            }
        }

        async function checkAPI() {
            const status = document.getElementById('api-status');
            status.innerHTML = '<div class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º API...</div>';

            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
                const response = await fetch(`${API_BASE}/v1/users/check-access/434532312`);
                
                if (response.ok) {
                    const data = await response.json();
                    status.innerHTML = `
                        <div class="status success">
                            <strong>‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω!</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                    log('API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    return data;
                } else {
                    status.innerHTML = `<div class="status error">‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${response.status} ${response.statusText}</div>`;
                    log(`API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${response.status}`, 'error');
                    return null;
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API: ${error.message}</div>`;
                log(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API: ${error.message}`, 'error');
                return null;
            }
        }

        async function testAuth() {
            const status = document.getElementById('auth-status');
            status.innerHTML = '<div class="status info">–¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...</div>';

            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Å —Ç–µ—Å—Ç–æ–≤—ã–º telegram_id
                const response = await fetch(`${API_BASE}/v1/users/auth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        telegram_id: 434532312
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    
                    status.innerHTML = `
                        <div class="status success">
                            <strong>‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                    log('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞', 'success');
                    return data;
                } else {
                    const errorText = await response.text();
                    status.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${response.status}<br><pre>${errorText}</pre></div>`;
                    log(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${response.status} - ${errorText}`, 'error');
                    return null;
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}</div>`;
                log(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                return null;
            }
        }

        async function testCheckAccess() {
            if (!currentUser) {
                log('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é', 'warning');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/v1/users/check-access/434532312`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞: ${JSON.stringify(data, null, 2)}`, 'info');
                    
                    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ–ª—å
                    if (data.role === 'creator') {
                        log('‚úÖ –†–æ–ª—å "creator" –Ω–∞–π–¥–µ–Ω–∞ - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞', 'success');
                    } else {
                        log(`‚ö†Ô∏è –†–æ–ª—å "${data.role}" - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`, 'warning');
                    }
                } else {
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É...', 'info');
            setTimeout(checkTelegramWebApp, 1000);
            setTimeout(checkAPI, 2000);
            setTimeout(testAuth, 3000);
        };
    </script>
</body>
</html>
