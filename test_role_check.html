<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .test { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        pre { background: #e9ecef; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
    
    <div class="test">
        <h3>–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
        <button onclick="testAuth()">–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
        <div id="auth-result"></div>
    </div>

    <div class="test">
        <h3>–¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button onclick="checkUserRole()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å</button>
        <div id="role-result"></div>
    </div>

    <div class="test">
        <h3>–¢–µ—Å—Ç 3: –°–∏–º—É–ª—è—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞</h3>
        <button onclick="simulateFrontend()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥</button>
        <div id="frontend-result"></div>
    </div>

    <script>
        const API_BASE = 'https://projectmanager.chickenkiller.com/api';
        let authData = null;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        async function testAuth() {
            try {
                log('auth-result', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...', 'warning');
                
                const response = await fetch(`${API_BASE}/v1/users/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: 434532312 })
                });

                if (response.ok) {
                    authData = await response.json();
                    log('auth-result', `
                        <strong>‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</strong><br>
                        <pre>${JSON.stringify(authData, null, 2)}</pre>
                    `, 'success');
                } else {
                    const errorText = await response.text();
                    log('auth-result', `‚ùå –û—à–∏–±–∫–∞: ${response.status}<br><pre>${errorText}</pre>`, 'error');
                }
            } catch (error) {
                log('auth-result', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function checkUserRole() {
            if (!authData) {
                log('role-result', '‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é', 'warning');
                return;
            }

            const user = authData.user;
            const role = user.role;
            
            let result = `<strong>–ê–Ω–∞–ª–∏–∑ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong><br>`;
            result += `<pre>${JSON.stringify(user, null, 2)}</pre><br>`;
            
            result += `<strong>–†–æ–ª—å: "${role}"</strong><br>`;
            
            if (role === 'creator') {
                result += `<strong>‚úÖ –†–æ–ª—å "creator" - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –î–û–õ–ñ–ù–ê –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞!</strong><br>`;
                result += `‚Ä¢ user?.role === 'creator' ‚Üí ${user?.role === 'creator'}<br>`;
                result += `‚Ä¢ user.role === 'creator' ‚Üí ${user.role === 'creator'}<br>`;
            } else {
                result += `<strong>‚ö†Ô∏è –†–æ–ª—å "${role}" - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ù–ï –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞</strong><br>`;
                result += `‚Ä¢ user?.role === 'creator' ‚Üí ${user?.role === 'creator'}<br>`;
                result += `‚Ä¢ user.role === 'creator' ‚Üí ${user.role === 'creator'}<br>`;
            }
            
            log('role-result', result, role === 'creator' ? 'success' : 'warning');
        }

        function simulateFrontend() {
            if (!authData) {
                log('frontend-result', '‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é', 'warning');
                return;
            }

            const user = authData.user;
            
            let result = `<strong>–°–∏–º—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:</strong><br><br>`;
            
            // –°–∏–º—É–ª—è—Ü–∏—è App.tsx
            result += `<strong>1. App.tsx –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong><br>`;
            result += `if (!user) { return <Unauthorized /> }<br>`;
            result += `user = ${JSON.stringify(user)}<br>`;
            result += `!user = ${!user}<br>`;
            result += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${!user ? '‚ùå –ü–æ–∫–∞–∑–∞—Ç—å Unauthorized' : '‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'}<br><br>`;
            
            // –°–∏–º—É–ª—è—Ü–∏—è App.tsx –º–∞—Ä—à—Ä—É—Ç–∞
            result += `<strong>2. App.tsx –º–∞—Ä—à—Ä—É—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:</strong><br>`;
            result += `{user.role === 'creator' && (<Route path="/admin" element={<AdminPanel />} />)}<br>`;
            result += `user.role = "${user.role}"<br>`;
            result += `user.role === 'creator' = ${user.role === 'creator'}<br>`;
            result += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${user.role === 'creator' ? '‚úÖ –ú–∞—Ä—à—Ä—É—Ç /admin –¥–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ú–∞—Ä—à—Ä—É—Ç /admin –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω'}<br><br>`;
            
            // –°–∏–º—É–ª—è—Ü–∏—è Layout.tsx
            result += `<strong>3. Layout.tsx –Ω–∞–≤–∏–≥–∞—Ü–∏—è:</strong><br>`;
            result += `(user?.role === 'creator' ? adminNavigation : navigation)<br>`;
            result += `user?.role = "${user?.role}"<br>`;
            result += `user?.role === 'creator' = ${user?.role === 'creator'}<br>`;
            result += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${user?.role === 'creator' ? '‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–Ω–∞–≤–∏–≥–∞—Ü–∏—é' : '‚ùå –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ã—á–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é'}<br><br>`;
            
            // –°–∏–º—É–ª—è—Ü–∏—è AdminPanel.tsx
            result += `<strong>4. AdminPanel.tsx –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong><br>`;
            result += `if (user?.role !== 'creator') { return "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω" }<br>`;
            result += `user?.role = "${user?.role}"<br>`;
            result += `user?.role !== 'creator' = ${user?.role !== 'creator'}<br>`;
            result += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${user?.role !== 'creator' ? '‚ùå –ü–æ–∫–∞–∑–∞—Ç—å "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"' : '‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å'}<br><br>`;
            
            // –û–±—â–∏–π –≤—ã–≤–æ–¥
            const hasAccess = user?.role === 'creator';
            result += `<strong>üéØ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:</strong><br>`;
            result += `–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ${hasAccess ? '‚úÖ –î–û–°–¢–£–ü–ù–ê' : '‚ùå –ù–ï –î–û–°–¢–£–ü–ù–ê'}<br>`;
            
            log('frontend-result', result, hasAccess ? 'success' : 'error');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setTimeout(testAuth, 1000);
        };
    </script>
</body>
</html>
